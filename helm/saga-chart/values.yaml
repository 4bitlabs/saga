# Valores padrão para saga-chart
# Este é um arquivo formatado em YAML.

# Configuração da Aplicação
app:
  name: "saga-api"
  packageName: "br.com.cacadoresti.saga"
  replicaCount: 1
  springProfile: "dev"
  debug: false
  
  image:
    repository: "ghcr.io/4bitlabs/saga"
    pullPolicy: IfNotPresent
    tag: "main-b873961"
  
  service:
    type: ClusterIP
    port: 80
  
  # Recursos reduzidos para evitar problemas de memória insuficiente
  # Durante rollout canary, pods adicionais são criados temporariamente
  resources:
    limits:
      cpu: 1000m
      memory: 768Mi  # Reduzido de 1Gi para 768Mi
    requests:
      cpu: 500m
      memory: 384Mi  # Reduzido de 512Mi para 384Mi
  
  securityContext:
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    runAsUser: 1000
    capabilities:
      drop:
        - ALL
  
  podSecurityContext:
    fsGroup: 1000

# Configuração do banco de dados
# Nota: O banco de dados é gerenciado pelo chart postgres-chart separado
# Estas são apenas as configurações de conexão para a aplicação
database:
  clusterName: "saga-chart-postgres"
  host: "saga-chart-postgres-rw"
  port: 5432
  name: "sighas"
  username: "admin"
  password: "admin"

# Configuração do Job de Migração
migration:
  enabled: true
  image:
    repository: "ghcr.io/4bitlabs/saga"
    tag: "main-b873961"
  annotations:
    argocd.argoproj.io/sync-wave: "1"

# Configuração do Rollout (Argo Rollouts)
rollout:
  # Estratégia de deployment: "blueGreen" ou "canary"
  strategy: "blueGreen"
  
  # Configurações para BlueGreen
  blueGreen:
    # Auto-promoção desabilitada por padrão (requer promoção manual)
    autoPromotionEnabled: false
    # Delay antes de escalar down a versão antiga (em segundos)
    scaleDownDelaySeconds: 30
  
  # Configurações para Canary
  canary:
    # Passos de incremento de tráfego
    steps:
      - setWeight: 10
      - pause: {}
      - setWeight: 25
      - pause: {}
      - setWeight: 50
      - pause: {}
      - setWeight: 75
      - pause: {}
      - setWeight: 100